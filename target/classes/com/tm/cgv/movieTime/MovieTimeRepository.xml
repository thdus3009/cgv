<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tm.cgv.movieTime.MovieTimeRepository">
 	
 	<select id="movieTimeSelectOne" parameterType="Integer" resultType="MovieTimeVO">
 		SELECT * FROM movieTime WHERE num = #{num} AND deleteAt IS NULL 
 	</select>
 	
 	<select id="selectNumByScreenDate" parameterType="MovieTimeVO" resultType="Integer">
 		SELECT num FROM movieTime WHERE screenDate <![CDATA[<=]]> #{screenDate} AND deleteAt IS NULL
 	</select>

	<select id="selectTheaterNumByNum" parameterType="MovieTimeVO" resultType="Integer">
 		SELECT theaterNum FROM movieTime WHERE num=#{num} AND deleteAt IS NULL
 	</select>
 	
 	<select id="selectOneRecently" resultType="MovieTimeVO">
 		SELECT * FROM movieTime ORDER BY num DESC LIMIT 1;
 	</select>
	 	
 	<update id="updateDeleteAtByScreenDate" parameterType="MovieTimeVO">
 		UPDATE movieTime SET deleteAt=now() WHERE screenDate <![CDATA[<=]]> #{screenDate}
 	</update>
 	
 	<update id="remainSeatUpdate" parameterType="MovieTimeVO">
 		UPDATE movieTime SET remainSeat=#{remainSeat} WHERE num = #{num} AND deleteAt IS NULL
 	</update>

 	<insert id="insert" parameterType="MovieTimeVO">
 		INSERT INTO movieTime VALUES(
 			0, #{movieNum}, #{theaterNum}, #{screenDate}, #{screenTime}, #{remainSeat}, #{selectedFilm}, null
 		)
 	</insert>

 	<update id="remainSeatSum" parameterType="MovieTimeVO">
 		UPDATE movieTime SET remainSeat = remainSeat + #{remainSeat} WHERE num =#{num}
 	</update>
 
 	<select id="movieTimeList" parameterType="Integer" resultType="Integer">
 		select num from movieTime where theaterNum=#{theaterNum}
 	</select>

</mapper>